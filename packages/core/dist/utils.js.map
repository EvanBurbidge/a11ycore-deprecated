{"version":3,"sources":["utils.js"],"names":["isHTMLElement","html","tagName","isHTMLString","test","mount","document","body","contains","outerHTML","originalHTML","innerHTML","Error","checkStatusOfBuild","build","severe","moderate","Object","assign","status","normaliseBuild","projectId","results","admin","issues","created","firestore","Timestamp","now","violations","forEach","result","idx","push","id","name","impact","description","help","nodes","filter","Boolean","map","n","any","JSON","parse","stringify","e","isEmptyObjectorNull","value","entries","length","constructor","module","exports"],"mappings":"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","sourcesContent":["/**\n * Checks if the HTML parameter provided is a HTML element.\n * @param {Element} a HTML element or a HTML string\n * @returns {boolean} true or false\n */\nfunction isHTMLElement(html) {\n  return !!html && typeof html === 'object' && typeof html.tagName === 'string'\n}\n\n/**\n * Checks that the HTML parameter provided is a string that contains HTML.\n * @param {string} a HTML element or a HTML string\n * @returns {boolean} true or false\n */\nfunction isHTMLString(html) {\n  return typeof html === 'string' && /(<([^>]+)>)/i.test(html)\n}\n\n/**\n * Converts a HTML string or HTML element to a mounted HTML element.\n * @param {Element | string} a HTML element or a HTML string\n * @returns {[Element, function]} a HTML element and a function to restore the document\n */\nfunction mount (html) {\n  if (isHTMLElement(html)) {\n    if (document.body.contains(html)) {\n      return [html, () => undefined]\n    }\n    html = html.outerHTML\n  }\n\n  if (isHTMLString(html)) {\n    const originalHTML = document.body.innerHTML\n    const restore = () => {\n      document.body.innerHTML = originalHTML\n    }\n\n    document.body.innerHTML = html\n    return [document.body, restore]\n  }\n\n  if (typeof html === 'string') {\n    throw new Error(`html parameter (\"${html}\") has no elements`)\n  }\n\n  throw new Error(`html parameter should be an HTML string or an HTML element`)\n}\n\n\nfunction checkStatusOfBuild(build) {\n  if (build.severe === 0 || build.moderate === 0) {\n    return Object.assign({}, build, {\n      status: 'PASSING',\n    });\n  }\n  if (build.severe > build.moderate) {\n    return Object.assign({}, build, {\n      status: 'SEVERE',\n    });\n  }\n  return Object.assign({}, build, {\n    status: 'MODERATE',\n  });\n}\n\nfunction normaliseBuild(projectId, results, admin) {\n  let build = {\n    projectId,\n    severe: 0,\n    issues: [],\n    moderate: 0,\n    status: 'PASSING',\n    created: admin.firestore.Timestamp.now(),\n  };\n  results.violations.forEach((result, idx) => {\n    build.issues.push({\n      id: result.id,\n      name: `Issue ${idx + 1}`,\n      impact: result.impact,\n      description: result.description,\n      help: result.help,\n      nodes: result.nodes.filter(Boolean).map(n => {\n        try {\n          const any = JSON.parse(JSON.stringify(n.any));\n          return Object.assign({}, n, { any });\n        } catch (e) {\n          throw Error(e);\n        }\n      }),\n    });\n    if (result.impact === 'critical') {\n      build.severe = build.severe += 1;\n    }\n    if (result.impact === 'moderate') {\n      build.moderate = build.moderate += 1;\n    }\n  });\n  return checkStatusOfBuild(build);\n};\n\nfunction isEmptyObjectorNull(value) {\n  if (value == null) return true\n  return Object.entries(value).length === 0 && value.constructor === Object\n}\n\nmodule.exports = {\n  mount,\n  normaliseBuild,\n  isEmptyObjectorNull,\n}"]}